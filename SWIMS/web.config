<?xml version="1.0" encoding="utf-8"?>
<configuration>

	<!-- Root: ASP.NET Core app wiring -->
	<system.webServer>
		<!-- Map *all* requests to the AspNetCoreModuleV2 -->
		<handlers>
			<add name="aspNetCore"
				 path="*"
				 verb="*"
				 modules="AspNetCoreModuleV2"
				 resourceType="Unspecified" />
		</handlers>

		<!-- Framework-dependent publish (uses dotnet + your DLL): -->
		<aspNetCore processPath="dotnet"
					arguments=".\SWIMS.dll"
					stdoutLogEnabled="false"
					stdoutLogFile=".\logs\stdout"
					hostingModel="inprocess" />

		<security>
			<requestFiltering>
				<requestLimits maxQueryString="8192" />
			</requestFiltering>
		</security>
	</system.webServer>

	<!-- Force all /ssrs requests into ASP.NET Core, even if a physical folder exists -->
	<location path="ssrs">
		<system.webServer>
			<directoryBrowse enabled="false" />
			<defaultDocument enabled="false">
				<files>
					<clear />
				</files>
			</defaultDocument>

			<httpErrors existingResponse="PassThrough" />
			<security>
				<requestFiltering allowDoubleEscaping="true">
					<fileExtensions allowUnlisted="true" />
				</requestFiltering>
			</security>

			<!-- Nuke inherited rewrite rules just for /ssrs -->
			<rewrite>
				<rules>
					<clear />
				</rules>
			</rewrite>

			<!-- Critical: ensure /ssrs is handled by AspNetCore, not StaticFile -->
			<handlers accessPolicy="Read, Script">
				<clear />
				<add name="aspNetCore-ssrs"
					 path="*"
					 verb="*"
					 modules="AspNetCoreModuleV2"
					 resourceType="Unspecified" />
			</handlers>

		</system.webServer>
	</location>

</configuration>
