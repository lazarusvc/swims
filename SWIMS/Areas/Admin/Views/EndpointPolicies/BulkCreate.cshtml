@model SWIMS.Areas.Admin.ViewModels.AccessControl.EndpointPolicyEditViewModel
@using SWIMS.Services.Diagnostics
@{
    ViewData["Title"] = "Bulk Apply Policy";
    var controllers = (IReadOnlyList<(string? Area, string Controller)>)ViewBag.Controllers;
    var actions = (IReadOnlyList<ControllerActionInfo>)ViewBag.Actions;
    var pages = (IReadOnlyList<RazorPageInfo>)ViewBag.Pages;
}
<h2>Bulk Apply Policy</h2>
<form asp-action="BulkCreate" method="post">
    @Html.AntiForgeryToken()

    <div class="mb-3">
        <label class="form-label">Policy</label>
        <select asp-for="PolicyName" asp-items="Model.Policies" class="form-select"></select>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h5 class="mt-3">Controller Actions</h5>
            <div class="border rounded p-2" style="max-height: 320px; overflow:auto;">
                @foreach (var a in actions)
                {
                    var key = $"{a.Area}|{a.Controller}|{a.Action}";
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="controllerActions" value="@key" id="@key">
                        <label class="form-check-label" for="@key">@($"{a.Area ?? "(root)"} / {a.Controller}:{a.Action}")</label>
                    </div>
                }
            </div>
        </div>
        <div class="col-md-6">
            <h5 class="mt-3">Razor Pages</h5>
            <div class="border rounded p-2" style="max-height: 320px; overflow:auto;">
                @foreach (var p in pages)
                {
                    var key = $"{p.Area}|{p.PageRoute}";
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="pages" value="@key" id="@key">
                        <label class="form-check-label" for="@key">@($"{p.Area ?? "(root)"} {p.PageRoute}")</label>
                    </div>
                }
            </div>
        </div>
    </div>

    <hr />
    <div class="row g-3">
        <div class="col-md-3">
            <div class="form-check form-switch">
                <input class="form-check-input" asp-for="IsEnabled" />
                <label class="form-check-label" asp-for="IsEnabled">Enabled</label>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label" asp-for="Priority"></label>
            <input class="form-control" asp-for="Priority" />
        </div>
        <div class="col-md-6">
            <label class="form-label" asp-for="Notes"></label>
            <input class="form-control" asp-for="Notes" />
        </div>
    </div>

    <div class="mt-3">
        <button class="btn btn-primary">Apply Policy</button>
        <a asp-action="Index" class="btn btn-secondary">Cancel</a>
    </div>
</form>
