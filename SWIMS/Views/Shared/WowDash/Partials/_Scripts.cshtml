@*
    WowDash - ASP.Net Core 8 & Bootstrap Admin Dashboard Multipurpose Template design by Parv Infotech
*@

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!-- jQuery library js -->
<script src="~/WowDash/js/lib/jquery-3.7.1.min.js"></script>
<!-- Bootstrap js -->
<script src="~/WowDash/js/lib/bootstrap.bundle.min.js"></script>
<!-- Apex Chart js -->
<script src="~/WowDash/js/lib/apexcharts.min.js"></script>
<!-- Data Table js -->
<script src="~/WowDash/js/lib/dataTables.min.js"></script>
<!-- Iconify Font js -->
<script src="~/WowDash/js/lib/iconify-icon.min.js"></script>
<!-- jQuery UI js -->
<script src="~/WowDash/js/lib/jquery-ui.min.js"></script>
<!-- Vector Map js -->
<script src="~/WowDash/js/lib/jquery-jvectormap-2.0.5.min.js"></script>
<script src="~/WowDash/js/lib/jquery-jvectormap-world-mill-en.js"></script>
<!-- Popup js -->
<script src="~/WowDash/js/lib/magnifc-popup.min.js"></script>
<!-- Slick Slider js -->
<script src="~/WowDash/js/lib/slick.min.js"></script>
<!-- prism js -->
<script src="~/WowDash/js/lib/prism.js"></script>
<!-- file upload js -->
<script src="~/WowDash/js/lib/file-upload.js"></script>
<!-- audioplayer -->
<script src="~/WowDash/js/lib/audioplayer.js"></script>

<!-- main js -->
<script src="~/WowDash/js/app.js"></script>

<script src="~/lib/signalr/signalr.min.js"></script>

<script src="~/WowDash/js/notifs.js" asp-append-version="true"></script>

<script src="~/WowDash/js/chat.js"></script>

<script>
    (function () {
      const ping = () => fetch(window.apiUrl('/api/v1/me/heartbeat'), {
        method: 'POST',
        headers: { 'X-Requested-With': 'fetch' },
        credentials: 'same-origin',
        keepalive: true
      }).catch(()=>{});

      const start = () => {
        ping(); // first hit ~10s after load
        setTimeout(ping, 10 * 1000);
        // then every 5 minutes while visible
        let timer = setInterval(() => { if (!document.hidden) ping(); }, 5 * 60 * 1000);
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden) ping();
        });
        window.addEventListener('beforeunload', ping);
      };

      if (document.readyState === 'complete' || document.readyState === 'interactive') start();
      else document.addEventListener('DOMContentLoaded', start);
    })();
</script>

<script>
    (function () {
      const conn = new signalR.HubConnectionBuilder()
        .withUrl(window.apiUrl('/hubs/notifs'), { withCredentials: true })
        .withAutomaticReconnect()
        .build();

      conn.on("notif", n => console.log("🔔 notif:", n));
      conn.start().catch(console.error);
    })();
</script>





