@using Microsoft.AspNetCore.Identity
@inject UserManager<SwUser> UserManager
@model SWIMS.Models.SW_formTableDatum

<!-- BACK BUTTON -->
<div style="width: 110px;">
    <a href="##" onClick="history.go(-1); return false;"
       class="btn rounded-pill btn-outline-dark-1 radius-8 px-20 py-11 d-flex align-items-center gap-2">
        <iconify-icon icon="ion:return-up-back-sharp"></iconify-icon> Back
    </a>
    <br />
    <br />
</div>
<!-- ----------------------------------------------- -->
@{
    ViewData["Title"] = "Approval / Recommendation for - Entry#: " + ViewBag.dataID;
}

<!-- PREVIEW MODAL ____________________________________________ -->
<div id="ex1" class="modal">
</div>

<form asp-action="ApprovalAction" asp-controller="form" method="post">
    <input type='hidden' id="uuid" name="uuid" value="@ViewBag.uuid" />
    <input type='hidden' asp-for='Id' value='@ViewBag.dataID' /><br />

    <h5>Take Action ::</h5>
    <p>On behalf of: @UserManager.GetUserName(User)</p>    
    <a href="#ex1" onclick="_PREV('@ViewBag.dataID', '@ViewBag.uuid')" rel="modal:open" class="btn rounded-pill btn-outline-dark-1 radius-8 px-20 py-11 d-flex align-items-center gap-2"><iconify-icon icon="iconamoon:eye-light"></iconify-icon> View Form</a>
    <br />
    <hr />

    @if (ViewBag.AppCnt == 1) //   ------ APPROVER 1
    {
        <input type='hidden' asp-for='isApproval_01' value=1 /><br />
        <input type='hidden' asp-for='isApproval_02' value=0 /><br />
        <input type='hidden' asp-for='isApproval_03' value=0 /><br />
        <input type='hidden' asp-for='isApproval_04' value=0 /><br />
        <input type='hidden' asp-for='isApproval_05' value=0 /><br />
        <input type="hidden" asp-for='isApp_dateTime_01' value="@System.DateTime.Now" />
        <textarea class='textareaTrum' asp-for='isAppComment_01' placeholder='your comment ...'></textarea><br />
        <input type='hidden' asp-for='isApprover_01' value='@UserManager.GetUserName(User)' /><br />
        <input type='hidden' asp-for='SW_formsId' value='@ViewBag.formId' /><br />
    }
    @if (ViewBag.AppCnt == 2) // ------ APPROVER 2
    {
        <input type='hidden' asp-for='isApproval_01' value=1 /><br />
        <input type='hidden' asp-for='isApproval_02' value=1 /><br />
        <input type='hidden' asp-for='isApproval_03' value=0 /><br />
        <input type='hidden' asp-for='isApproval_04' value=0 /><br />
        <input type='hidden' asp-for='isApproval_05' value=0 /><br />
        <input type="hidden" asp-for='isApp_dateTime_02' value="@System.DateTime.Now" />
        <textarea class='textareaTrum' asp-for='isAppComment_02' placeholder='your comment ...'></textarea><br />
        <input type='hidden' asp-for='isApprover_02' value='@UserManager.GetUserName(User)' />
        <input type='hidden' asp-for='SW_formsId' value='@ViewBag.formId' /><br />
    }
    @if (ViewBag.AppCnt == 3) // ------ APPROVER 3
    {
        <input type='hidden' asp-for='isApproval_01' value=1 /><br />
        <input type='hidden' asp-for='isApproval_02' value=1 /><br />
        <input type='hidden' asp-for='isApproval_03' value=1 /><br />
        <input type='hidden' asp-for='isApproval_04' value=0 /><br />
        <input type='hidden' asp-for='isApproval_05' value=0 /><br />
        <input type="hidden" asp-for='isApp_dateTime_03' value="@System.DateTime.Now" />
        <textarea class='textareaTrum' asp-for='isAppComment_03' placeholder='your comment ...'></textarea><br />
        <input type='hidden' asp-for='isApprover_03' value='@UserManager.GetUserName(User)' />
        <input type='hidden' asp-for='SW_formsId' value='@ViewBag.formId' /><br />
    }
    @if (ViewBag.AppCnt == 4) // ------ APPROVER 4
    {
        <input type='hidden' asp-for='isApproval_01' value=1 /><br />
        <input type='hidden' asp-for='isApproval_02' value=1 /><br />
        <input type='hidden' asp-for='isApproval_03' value=1 /><br />
        <input type='hidden' asp-for='isApproval_04' value=1 /><br />
        <input type='hidden' asp-for='isApproval_05' value=0 /><br />
        <input type="hidden" asp-for='isApp_dateTime_04' value="@System.DateTime.Now" />
        <textarea class='textareaTrum' asp-for='isAppComment_04' placeholder='your comment ...'></textarea><br />
        <input type='hidden' asp-for='isApprover_04' value='@UserManager.GetUserName(User)' />
        <input type='hidden' asp-for='SW_formsId' value='@ViewBag.formId' /><br />
    }
    @if (ViewBag.AppCnt == 5) // ------ APPROVER 5
    {
        <input type='hidden' asp-for='isApproval_01' value=1 /><br />
        <input type='hidden' asp-for='isApproval_02' value=1 /><br />
        <input type='hidden' asp-for='isApproval_03' value=1 /><br />
        <input type='hidden' asp-for='isApproval_04' value=1 /><br />
        <input type='hidden' asp-for='isApproval_05' value=1 /><br />
        <input type="hidden" asp-for='isApp_dateTime_05' value="@System.DateTime.Now" />
        <textarea class='textareaTrum' asp-for='isAppComment_05' placeholder='your comment ...'></textarea><br />
        <input type='hidden' asp-for='isApprover_05' value='@UserManager.GetUserName(User)' />
        <input type='hidden' asp-for='SW_formsId' value='@ViewBag.formId' /><br />
    }
    <div class="btn-group radius-8" role="group" aria-label="Default button group">
        <button type="submit" class="btn btn-success-600 px-20 py-11 radius-50">Submit | Move Forward</button>
        <button type="button" class="btn btn-danger-600 px-20 py-11 radius-50" id="revertBTN">Revert | Move to Beginning</button>
    </div>
</form>


<link href="~/css/forms-stylesheet.css" rel="stylesheet" />
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<link href="~/lib/trumbowyg-editor/ui/trumbowyg.min.css" rel="stylesheet" />
<script src="~/lib/trumbowyg-editor/trumbowyg.min.js"></script>
<script src="~/lib/jquery-modal/jquery.modal.min.js"></script>
<link href="~/lib/jquery-modal/jquery.modal.min.css" rel="stylesheet" />
<script type="text/javascript">
    jQuery(function ($) { // ---- Render TINYMCE - WYSWYGET EDITOR
        $(".textareaTrum").trumbowyg({
            btns: [
                ['viewHTML'],
                ['undo', 'redo'],
                ['formatting'],
                ['strong', 'em', 'del'],
                ['superscript', 'subscript'],
                ['link'],
                ['insertImage'],
                ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                ['unorderedList', 'orderedList'],
                ['horizontalRule'],
                ['removeformat'],
                ['fullscreen']
            ],
            autogrow: true
        });
    });

    jQuery(function($) { // ---- Revert Button logic
        $("#revertBTN").on('click', function() {

            $("#isApproval_01").val("0");
            $("#isApproval_02").val("0");
            $("#isApproval_03").val("0");
            $("#isApproval_04").val("0");
            $("#isApproval_05").val("0");

            var formData =
            {
                isApproval_01: $("#isApproval_01").val(),
                isApproval_02: $("#isApproval_02").val(),
                isApproval_03: $("#isApproval_03").val(),
                isApproval_04: $("#isApproval_04").val(),
                isApproval_05: $("#isApproval_05").val()
            };

            console.log(formData);

            $.ajax({
                url: '@Url.Action("ApprovalAction", "form")',
                type: "POST",
                data: formData,
                success: function () {
                    window.location = '@Url.Action("Program", "form")?uuid=@ViewBag.uuid';
                }
            });
        });
    });

    function _PREV(d, u) { // ---- Preview Button logic
        $.ajax({
            url: '@Url.Action("Preview", "form")?&dataID=' + d + "&uuid=" + u + "",
            type: "GET",
            success: function (result) {
                $("#ex1").html(result);
            }
        });
    }
</script>


